const a0_0x54fca6=a0_0x9df6;function a0_0x9df6(t,e){const n=a0_0x331d();return(a0_0x9df6=function(t,e){return n[t-=349]})(t,e)}(function(){const t=a0_0x9df6,e=a0_0x331d();for(;;)try{if(357689===parseInt(t(458))/1*(-parseInt(t(609))/2)+parseInt(t(502))/3+-parseInt(t(504))/4*(-parseInt(t(507))/5)+parseInt(t(616))/6*(-parseInt(t(463))/7)+parseInt(t(356))/8*(parseInt(t(481))/9)+-parseInt(t(354))/10+parseInt(t(478))/11*(parseInt(t(448))/12))break;e.push(e.shift())}catch(t){e.push(e.shift())}})(),console[a0_0x54fca6(557)](a0_0x54fca6(494));import{initializeApp}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";import{getDatabase,ref,set,get,push,update,child}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";const firebaseConfig={apiKey:a0_0x54fca6(552),authDomain:"dbs3-6a018.firebaseapp.com",databaseURL:a0_0x54fca6(438),projectId:a0_0x54fca6(545),storageBucket:a0_0x54fca6(464),messagingSenderId:a0_0x54fca6(533),appId:a0_0x54fca6(408)},app=initializeApp(firebaseConfig),db=getDatabase(app);function calculateTotal(){const t=a0_0x54fca6,e=function(){let t=!0;return function(e,n){const a=t?function(){if(n){const t=n[a0_0x9df6(539)](e,arguments);return n=null,t}}:function(){};return t=!1,a}}(),n=e(this,function(){const t=a0_0x9df6;return n[t(457)]()[t(492)](t(544))[t(457)]().constructor(n).search(t(544))});n();let a=0;document[t(442)](t(437))[t(395)](e=>{a+=Number(e[t(357)]||0)}),document[t(371)]("total_amount")[t(480)]="₹"+a}document[a0_0x54fca6(450)](a0_0x54fca6(355),t=>{const e=a0_0x54fca6;if(t.target.classList[e(436)]("feeAmount")&&calculateTotal(),t.target[e(543)][e(436)](e(485))){const n=t[e(396)].closest("tr").querySelector(e(385));t[e(396)][e(357)]===e(589)?(n[e(357)]="",n[e(540)][e(599)]=e(413)):n.style[e(599)]="inline-block"}if(t[e(396)][e(543)][e(436)]("sFeeType")){const n=t.target[e(428)](".studentFeeRow")[e(617)](e(546));t[e(396)].value===e(589)?(n[e(357)]="",n[e(540)][e(599)]=e(413)):n[e(540)][e(599)]=e(583)}}),document[a0_0x54fca6(371)](a0_0x54fca6(444)).addEventListener("click",()=>{const t=a0_0x54fca6,e=document[t(617)](t(439)),n=document.createElement("tr");n.innerHTML=t(541),e[t(517)](n)});const addFeeBtn=document.getElementById(a0_0x54fca6(404));async function loadRecentPayments(t){const e=a0_0x54fca6,n=document[e(371)](e(402));if(n.innerHTML="",t)try{const a=await get(ref(db,e(555)));if(!a[e(582)]())return;const o=Object[e(367)](a[e(391)]())[e(479)](([n,a])=>a[e(397)]===t).sort(([t,n],[a,o])=>new Date(o[e(351)])-new Date(n[e(351)]));for(const[a,d]of o){let o=[];if(d[e(425)])for(const n of Object[e(499)](d.monthsPaid)){const a=await get(ref(db,e(407)+t+e(451)+n+"/fees"));if(a[e(582)]()){const t=a[e(391)]();Object.values(t)[e(395)](t=>{const a=e;o[a(474)](n+a(410)+t.name+" ₹"+t.amount)})}}const s=document.createElement("tr");s[e(400)]=e(594)+(d[e(564)]||a)+e(515)+new Date(d[e(351)]).toLocaleDateString()+e(515)+(o[e(592)](e(513))||"-")+"</td>\n                <td>₹"+(d[e(586)]||0)+"</td>\n                <td>₹"+(d[e(551)]||0)+"</td>\n                <td>₹"+(d[e(522)]||0)+e(388)+(d[e(424)]||0)+e(532)+(d[e(551)]>0?"Paid":e(581))+'\n                    <button class="btn small recentPrintBtn" data-id="'+(d[e(564)]||a)+e(447),n[e(517)](s)}document[e(442)](e(550))[e(395)](t=>{const n=e;t[n(450)](n(411),()=>printReceipt(t.dataset.id))})}catch(t){console.error("Error loading recent payments:",t)}}async function printReceipt(t){const e=a0_0x54fca6;if(!t)return alert(e(353));const n=await get(ref(db,e(375)+t));if(!n[e(582)]())return alert("Payment not found");const a=n[e(391)](),o=await get(ref(db,e(407)+a.studentID)),d=o[e(582)]()?o[e(391)]():{};let s="";if(a[e(425)])for(const t of Object[e(499)](a[e(425)])){const n=await get(ref(db,e(407)+a[e(397)]+e(451)+t+e(559)));if(n[e(582)]()){const a=n[e(391)]();Object[e(384)](a)[e(395)](n=>{const a=e;s+=a(473)+t+"</td><td>"+n.name+a(399)+n.amount+"</td></tr>"})}}const c=window[e(401)]("",e(537)),r=e(386)+t+e(370)+(d[e(619)]||a[e(397)])+"</td>\n            <td><b>Class:</b> "+(d.studentClass||"-")+e(443)+a[e(397)]+"</td>\n            <td><b>Receipt ID:</b> "+t+"</td>\n          </tr>\n          <tr>\n            <td><b>Date:</b> "+new Date(a[e(351)])[e(525)]()+e(376)+(a[e(508)]||"-")+'</td>\n          </tr>\n        </table>\n      </div>\n\n      \x3c!-- FEE DETAILS --\x3e\n      <table class="fees">\n        <thead>\n          <tr>\n            <th>Month</th>\n            <th>Fee Name</th>\n            <th>Amount</th>\n          </tr>\n        </thead>\n        <tbody>\n          '+s+'\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Total</b></td>\n            <td><b>₹'+a[e(586)]+e(506)+a[e(551)]+'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Advance</b></td>\n            <td><b>₹'+a.advance+e(468)+a[e(522)]+e(467);c[e(365)].write(r),c.document[e(523)](),c[e(577)]()}async function generateAdminReport(t,e){const n=a0_0x54fca6,a=document[n(371)](n(572)),o=document[n(371)]("totalStudents"),d=document[n(371)]("paidCount"),s=document[n(371)](n(362));a[n(400)]="";const c=(await get(ref(db,n(422))))[n(391)]();let r=0,i=0,l=0,u=[],m=[];for(let a in c){const o=c[a];if(!o)continue;const d=o[n(394)][n(590)](n(360),"");if(t&&t!==n(379)&&d!==t)continue;r++;!0===o[n(471)]?.[e]?.[n(620)]?(i++,u[n(474)](n(403)+a+n(598)+o.studentName+n(598)+o[n(394)]+n(470)),m[n(474)]({admNo:a,name:o[n(619)],class:o[n(394)],status:n(383)})):(l++,u[n(474)](n(403)+a+"</td>\n        <td>"+o[n(619)]+n(598)+o[n(394)]+n(446)),m.push({admNo:a,name:o[n(619)],class:o[n(394)],status:"Unpaid"}))}a[n(400)]=u.join(""),o[n(480)]=r,d[n(480)]=i,s[n(480)]=l,window[n(430)]=m,updatePaymentChart(i,l)}function exportReportToCSV(t,e){const n=a0_0x54fca6;if(!window[n(430)]||0===window[n(430)][n(414)])return void(document[n(371)](n(358)).textContent=n(535));const a=[n(359),n(477),"Class",n(427)],o=window[n(430)].map(t=>[t[n(558)],'"'+t[n(441)]+'"',t[n(364)],t[n(452)]]),d=[a[n(592)](","),...o[n(387)](t=>t[n(592)](","))][n(592)]("\n"),s=new Blob([d],{type:n(528)}),c=document[n(433)]("a");c[n(361)]=URL.createObjectURL(s),c.download=n(597)+(t||n(379))+"_"+e+n(596),document.body.appendChild(c),c[n(411)](),document[n(575)][n(460)](c)}function a0_0x331d(){const t=["val","Error assigning fee: ","\n        </td>\n      ","studentClass","forEach","target","studentID","clearFee","</td><td>₹","innerHTML","open","recentPaymentsBody","<tr>\n        <td>","add-fee","#classFeeTable tbody tr","Error recording payment: ","Collected Data/","1:476698542874:web:41c0c69274d5d95a9522a3","#monthCollection"," - ","click"," - ₹","none","length","toISOString",".customFeeAmount","width","error","<li>No payments today</li>","payReceiptID","Please enter Admission Number","Collected Data",".customFeeName","advance","monthsPaid",".removeRow","Payment Status","closest","payRecord","currentReportData","\n      <thead>\n        <tr>\n          <th>Fee Name</th>\n          <th>Amount</th>\n          <th>Type</th>\n          <th>Frequency</th>\n        </tr>\n      </thead>\n      <tbody></tbody>\n    ","reduce","createElement","true","studentFeeRows","contains","#classFeeTable .feeAmount","https://dbs3-6a018-default-rtdb.firebaseio.com","#classFeeTable tbody",'</td>\n        <td colspan="4">\n          <select class="monthPaid">\n            <option value="false" selected>Not Paid</option>\n            <option value="true">Paid</option>\n          </select> Month Total: ₹',"name","querySelectorAll","</td>\n          </tr>\n          <tr>\n            <td><b>Admission No:</b> ","add-more",'\n    <td><input placeholder="Fee name e.g. Hostel" class="sFeeName" /></td>\n    <td><input type="number" placeholder="Amount" class="sFeeAmount" style="width:80px;" /></td>\n    <td>\n      <select class="sFeeType">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n    </td>\n    <td>\n      <select class="sFeeFrequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </td>\n  ','</td>\n        <td style="color:red;">Unpaid</td>\n      </tr>','">Print</button>\n                </td>\n            ',"4684884PYsvcS","searchBtn","addEventListener","/paymentsByMonth/","status","flatMap","children","min","message","toString","4673jGMbDx",".monthPaid","removeChild","Billing start month is locked","StudentFees/","21fPDBip","dbs3-6a018.firebasestorage.app","toLowerCase","exportReportToCSV",'</b></td>\n          </tr>\n          \n        </tbody>\n      </table>\n\n      \x3c!-- FOOTER --\x3e\n      <div class="footer">\n        This is a system generated receipt.<br>\n        Thank you for your payment!<br><br>\n        <i>Authorized Signatory</i>\n      </div>\n    </body>\n    </html>\n    ','</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Due</b></td>\n            <td><b>₹',"updatePaymentChart",'</td>\n        <td style="color:green;">Paid</td>\n      </tr>',"paymentsByMonth","text","<tr><td>","push","color","payStudent","Name","22wHjpwi","filter","textContent","1415241yEkFgZ","tbody","Search student first","select","type","FeeStructures/","#payRows tr","\n        <td>","/billingStartMonth","paySearchBtn","photo","search","payFather","Logic.js loaded","object","trim","Please select a Billing Start Month.","payTotalCalculated","keys","scrollIntoView","src","1561764TWDHTQ","payAddRow","896084ywZElV","getMonth",'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Paid</b></td>\n            <td><b>₹',"15QSGPUK","paymentMode","frequency","DOMContentLoaded","amount","Billing start month not set for student! Please assign student fee first.","<br>","billingStartMonth","</td>\n                <td>","smooth","appendChild","classKey","input","key","Yearly","outstanding","close","center","toLocaleString",".type","Student not found","text/csv;charset=utf-8;","#22c55e","remove","#ef4444","</td>\n                <td>\n                    ","476698542874","title","Run the report first to export data.","fees","_blank","No payments selected.","apply","style",'\n    <td><input type="text" class="feeName" placeholder="Fee name" /></td>\n    <td><input type="number" placeholder="0" class="feeAmount" /></td>\n    <td>\n      <select class="type">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n    </td>\n    <td>\n      <select class="frequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </td>',"paySearchInput","classList","(((.+)+)+)+$","dbs3-6a018",".sFeeFrequency","#000","paySelectedTotal","getContext",".recentPrintBtn","paidAmount","AIzaSyBcNxs1qgOUV9QUXyEHNs_gPyZQHGpZ1B8","studentCard","#ffffff","Payments","Payment recorded!","log","admNo","/fees","payTotalReceived","#studentFeeRows .studentFeeRow",".sFeeName",'input[placeholder*="Fee name"]',"receiptID",".sFeeAmount","pie","100%","payClass","payReceivedInput","#fff","Enter Admission No","reportRows","payBalance","setMonth","body",".sFeefrequency","print","split","assignFee","fromEntries","Pending","exists","inline-block",".feeName","padStart","selectedTotal","Billing start month not set for student!","green","one-time","replace","Student Fee Assigned!","join",'input[type="number"]',"\n                <td>","studentSearch",".csv","Fee_Report_","</td>\n        <td>","display","table","todayPayments","<li>Admission No: ","getFullYear","background","nextElementSibling","paymentNote","#todayCollection","Unpaid","214hhXXXC","payOutstanding","\n          <td></td>\n          <td>","recurring","payPhoto",".sFeeType","innerText","1236828UIjmFn","querySelector","Error fetching student: ","studentName","paid","/paymentsByMonth","#studentFeeRows table tbody tr","studentFeeTable","date","Loading student...","Invalid receipt ID","6546000npiMyK","change","8FexGLg","value","reportFeedback","Admission Number","Class ","href","unpaidCount","block","class","document","max","entries","session","fatherName",'</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\n        .header img { height: 60px; }\n        .school-name { font-size: 20px; font-weight: bold; margin-top: 5px; }\n        .school-address { font-size: 12px; }\n        .details { margin-bottom: 20px; }\n        .details table { width: 100%; font-size: 14px; }\n        .details td { padding: 5px; }\n        table.fees { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n        table.fees th, table.fees td { border: 1px solid #000; padding: 8px; text-align: left; }\n        table.fees th { background: #f0f0f0; }\n        .footer { margin-top: 30px; text-align: center; font-size: 12px; border-top: 1px dashed #000; padding-top: 10px; }\n      </style>\n    </head>\n    <body>\n      \x3c!-- HEADER --\x3e\n      <div class="header">\n        <img src="https://via.placeholder.com/100x60?text=Logo" alt="School Logo"/>\n        <div class="school-name">Marsmeta Tech</div>\n        <div class="school-address">123 Main Street, City, State - 123456</div>\n      </div>\n\n      \x3c!-- STUDENT DETAILS --\x3e\n      <div class="details">\n        <table>\n          <tr>\n            <td><b>Student Name:</b> ',"getElementById","destroy","from","disabled","Payments/","</td>\n            <td><b>Payment Mode:</b> ","</td>\n        ","options","All",".feeAmount","slice","borderCollapse","Paid","values",".frequency","\n    <html>\n    <head>\n      <title>Receipt - ","map","</td>\n                <td>₹","generateAdminReport","collapse"];return(a0_0x331d=function(){return t})()}function updatePaymentChart(t,e){const n=a0_0x54fca6,a=document[n(371)]("paymentChart")[n(549)]("2d");window.paymentChartInstance&&window.paymentChartInstance[n(372)](),window.paymentChartInstance=new Chart(a,{type:n(566),data:{labels:[n(383),n(608)],datasets:[{data:[t,e],backgroundColor:[n(529),n(531)],borderColor:[n(554),n(554)],borderWidth:1}]}})}async function loadCollections(){const t=a0_0x54fca6,e=getDatabase(),n=ref(e,"Payments"),a=await get(n);let o=0,d=0,s=[];if(a[t(582)]()){const e=a.val(),n=(new Date).toISOString()[t(381)](0,10),c=(new Date)[t(415)]()[t(381)](0,7);for(let a in e){const r=e[a];if(!r[t(351)]||!r.paidAmount)continue;const i=new Date(r[t(351)])[t(415)](),l=i[t(381)](0,10),u=i[t(381)](0,7);l===n&&(o+=Number(r[t(551)]),s.push(t(602)+r[t(397)]+t(412)+r[t(551)]+"</li>")),u===c&&(d+=Number(r[t(551)]))}}document[t(442)](t(607))[t(395)](e=>e[t(615)]=o),document[t(442)](t(409))[t(395)](e=>e[t(615)]=d);document[t(371)](t(601))[t(400)]=s[t(414)]?s[t(592)](""):t(419)}addFeeBtn&&addFeeBtn[a0_0x54fca6(450)]("click",()=>{const t=a0_0x54fca6,e=document[t(371)](t(518)),n=document[t(371)](t(368));if(!e||!n)return;const a=e[t(378)][e.selectedIndex][t(472)],o=(n[t(357)][t(496)](),{});document[t(442)](t(405))[t(395)](e=>{const n=t,a=e[n(617)](n(584)),d=e[n(617)](n(380)),s=e.querySelector(n(526)),c=e.querySelector(n(385)),r=a?a[n(357)][n(496)]():"",i=d?Number(d[n(357)]||0):0;!r||i<=0||(o[r]={amount:i,type:s?s[n(357)]:"",frequency:c&&c.style[n(599)]!==n(413)?c.value:""})}),set(ref(db,t(486)+a),o),alert("Class Fee Saved!")}),document[a0_0x54fca6(371)](a0_0x54fca6(449)).addEventListener(a0_0x54fca6(411),async()=>{const t=a0_0x54fca6,e=document[t(371)](t(595))[t(357)].trim();if(!e)return alert(t(571));const n=await get(ref(db,"Collected Data/"+e));if(!n[t(582)]())return void alert(t(527));const a=n.val();document.getElementById(t(553))[t(540)][t(599)]=t(363),document[t(371)](t(619)).value=a.studentName||"",document[t(371)](t(394)).value=a.studentClass||"",document[t(371)]("fatherName").value=a[t(369)]||"";const o=document[t(371)]("billingStartMonth"),d=await get(ref(db,t(462)+e));d[t(582)]()&&d[t(391)]()[t(514)]?(o[t(357)]=d[t(391)]()[t(514)],o[t(374)]=!0,o[t(540)][t(604)]=t(570),o[t(540)][t(475)]="#000",o[t(534)]="Billing start month is locked"):(o[t(357)]="",o[t(374)]=!1,o[t(540)][t(604)]="",o.style[t(475)]="",o[t(534)]="")}),window.addStudentFeeRow=function(){const t=a0_0x54fca6,e=document.getElementById(t(435));let n=e[t(617)](t(600));!n&&(n=document.createElement(t(600)),n.id=t(350),n[t(540)][t(417)]=t(567),n[t(540)][t(382)]=t(390),n[t(400)]=t(431),e.appendChild(n));const a=n[t(617)](t(482)),o=document.createElement("tr");o[t(400)]=t(445),a.appendChild(o);const d=o[t(617)](t(614)),s=o[t(617)](t(546));d.addEventListener(t(355),()=>{const e=t;d[e(357)]===e(589)?s[e(540)].display="none":s[e(540)].display="inline-block"}),d.dispatchEvent(new Event("change"))},window[a0_0x54fca6(579)]=async function(){const t=a0_0x54fca6,e=document[t(371)]("studentSearch")[t(357)][t(496)]();if(!e)return alert(t(483));const n=document[t(371)](t(514));let a=n[t(357)];const o=ref(db,"StudentFees/"+e),d=await get(o);let s={},c=!1;if(d[t(582)]()){const e=d.val();e[t(536)]&&typeof e[t(536)]===t(495)?s=e[t(536)]:Object[t(367)](e)[t(395)](([e,n])=>{const a=t;"billingStartMonth"!==e&&typeof n===a(495)&&null!=n[a(511)]&&(s[e]=n)}),e[t(514)]?(c=!0,n[t(357)]=e[t(514)],a=e[t(514)],n[t(374)]=!0,n.style[t(604)]=t(570),n[t(540)][t(475)]=t(547),n.title=t(461)):n[t(374)]=!1}if(!c&&!a)return void alert(t(497));if([...Array.from(document[t(442)](t(561))),...Array[t(373)](document[t(442)](t(349)))][t(395)](e=>{const n=t,a=e[n(617)](n(562))||e[n(617)](n(563)),o=e[n(617)](n(565))||e[n(617)](n(593)),d=e.querySelector(n(614))||e[n(617)](n(484)),c=e[n(617)](n(576))||e[n(617)](n(546)),r=(a?.value||"")[n(496)](),i=Number(o?.value||0),l=(d?.[n(357)]||"")[n(496)]()[n(465)](),u=l===n(612)&&c?c[n(357)]:null;r&&i>0&&(s[r]={amount:i,type:l,frequency:u})}),0===Object[t(499)](s)[t(414)])return void alert("Please add at least one valid fee before assigning!");const r={[t(462)+e+t(489)]:a,[t(462)+e+t(559)]:s};d[t(582)]()&&!d[t(391)]()[t(536)]&&Object.keys(d.val()||{})[t(395)](n=>{n!==t(514)&&"fees"!==n&&(r["StudentFees/"+e+"/"+n]=null)});try{await update(ref(db),r),alert(t(591));const e=document[t(371)](t(435));e&&(e[t(400)]=""),n[t(374)]=!0,n.style[t(604)]="#fff",n[t(540)][t(475)]="#000",n[t(534)]=t(461)}catch(e){console[t(418)](e),alert(t(392)+e.message)}},window[a0_0x54fca6(398)]=function(){const t=a0_0x54fca6;document[t(371)](t(435))[t(400)]='\n    <div class="row four studentFeeRow">\n      <input placeholder="Fee name e.g. Transport" class="sFeeName" />\n      <input type="number" placeholder="Amount" class="sFeeAmount" />\n      <select class="sFeeType">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n      <select class="sFeeFrequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </div>'},calculateTotal(),document[a0_0x54fca6(450)](a0_0x54fca6(510),()=>{const t=a0_0x54fca6,e=document[t(371)](t(542)),n=document[t(371)](t(490)),a=document[t(371)]("payRows"),o=document[t(371)]("payFeedback"),d=(document[t(371)](t(569)),document[t(371)]("payTotalCalculated"),document[t(371)](t(560)),document[t(371)](t(573)),document[t(371)](t(429))),s=document[t(371)](t(503));let c=null,r={};async function i(e,n){const d=t;a.innerHTML="",r={};const s=await get(ref(db,"StudentFees/"+e));let c=s[d(582)]()?s.val()[d(514)]:null;if(!c)return o[d(480)]=d(587),void window.alert(d(512));const i=await get(ref(db,d(486)+n)),u=i[d(582)]()?i.val():{},m=function(e){const n=t,a=[],[o,d]=e[n(578)]("-")[n(387)](Number);let s=new Date(o,d-1,1);for(;3!==s.getMonth()||s[n(603)]()!==o+1;){const t=s.getFullYear()+"-"+String(s[n(505)]()+1)[n(585)](2,"0");a.push(t),s[n(574)](s[n(505)]()+1)}return a}(c);if(m[d(395)](t=>{const e=d;r[t]=[];for(const[n,a]of Object[e(367)](u)){const o=a[e(509)]||e(589),d="Monthly"===o,s=o===e(521)||o===e(589);(d||s&&t===c)&&r[t].push({name:n,amount:a.amount})}}),s[d(582)]()){const t=s[d(391)]()[d(536)]||{};for(const[e,n]of Object[d(367)](t))m[d(395)](t=>{const a=d,o=n.type===a(612),s=n[a(485)]===a(589);(o||s&&t===c)&&r[t][a(474)]({name:e,amount:n[a(511)]})})}const p=await get(ref(db,d(407)+e+d(621))),f=p[d(582)]()?p[d(391)]():{};for(const t of Object[d(499)](r))f[t]?.[d(620)]&&delete r[t];for(const[t,e]of Object[d(367)](r)){if(0===e.length)continue;const n=e[d(432)]((t,e)=>t+e[d(511)],0),o=document[d(433)]("tr");o[d(400)]=d(488)+t+d(440)+n+d(393),a[d(517)](o),e[d(395)](t=>{const e=d,n=document.createElement("tr");n[e(400)]=e(611)+t[e(441)]+"</td>\n          <td>₹"+t[e(511)]+e(377),a[e(517)](n)}),o[d(617)](".monthPaid")[d(450)](d(355),t=>l())}const y=(await get(ref(db,d(407)+e)))[d(391)](),b=y?.outstanding||0,h=y?.advance||0;b>0&&alert("Warning: Student has previous outstanding of ₹"+b),h>0&&alert("Note: Student has advance balance of ₹"+h),l()}function l(){const e=t;let n=0,a=0,o=Number(document.getElementById("payOutstanding")[e(357)][e(590)]("₹",""))||0,d=Number(document[e(371)]("advance")[e(357)][e(590)]("₹",""))||0,s=d;document[e(442)](e(487))[e(395)](t=>{const o=e,d=t.querySelector(o(459));if(d){let e=0,s=t.nextElementSibling;for(;s&&!s.querySelector(o(459));){e+=Number(s.children[2][o(480)][o(590)]("₹",""))||0,s=s[o(605)]}n+=e,d[o(357)]===o(434)&&(a+=e)}const s=t[o(617)](o(416));if(s){const t=Number(s[o(357)]||0);n+=t,t>0&&(a+=t)}}),document[e(371)](e(498))[e(357)]="₹"+n,document[e(371)](e(548))[e(357)]="₹"+a;let c=a;document[e(371)](e(560)).value="₹"+c;let r=o;if(c<a)r=a-c-d+o,d>0&&(s=Math[e(366)](0,d-(a-c)));else if(c>a){let t=c-a;if(o>0){let e=Math.min(t,o);r=o-e,t-=e}t>0&&(s=d+t)}document[e(371)]("payOutstanding")[e(357)]="₹"+r,document[e(371)](e(424)).value="₹"+s,document.getElementById(e(573))[e(357)]="₹"+(a-c)}n[t(450)](t(411),async()=>{const n=t,a=e[n(357)][n(496)]();if(!a)return o[n(480)]=n(421),void(o[n(540)].display=n(363));o[n(480)]=n(352),o.style[n(599)]=n(363);try{const t=await get(ref(db,n(407)+a));if(await loadRecentPayments(a),!t[n(582)]())return void(o[n(480)]=n(527));const e=t.val();c={admNo:a,...e},document[n(371)](n(476))[n(357)]=e[n(619)]||"",document.getElementById(n(568))[n(357)]=e.studentClass||"",document[n(371)](n(493))[n(357)]=e[n(369)]||"",document.getElementById(n(613))[n(501)]=e[n(491)]||"default-avatar.png",document.getElementById(n(610))[n(357)]="₹"+(e.outstanding||0),document.getElementById("advance").value="₹"+(e[n(424)]||0),await i(a,e[n(394)]),o[n(540)].display="none"}catch(t){o[n(480)]=n(618)+t[n(456)],o[n(540)][n(599)]=n(363)}}),document[t(371)](t(560))[t(450)](t(519),function(){const e=t;let n=Number(document[e(371)](e(548))[e(357)][e(590)]("₹",""))||0,a=Number(this[e(357)].replace("₹",""))||0;document[e(371)]("payBalance")[e(357)]="₹"+(n-a)}),s[t(450)](t(411),()=>{const e=t,n=document.createElement("tr");n.innerHTML='\n    <td></td>\n    <td><input type="text" class="customFeeName" placeholder="Custom Fee Name"></td>\n    <td><input type="number" class="customFeeAmount" placeholder="Amount"></td>\n    <td><button type="button" class="removeRow">❌</button></td>\n    ',a[e(517)](n),n[e(617)](".customFeeAmount").addEventListener(e(519),l),n[e(617)](e(423))[e(450)](e(519),l),n[e(617)](e(426)).addEventListener(e(411),()=>{n[e(530)](),l()})}),d[t(450)]("click",async()=>{const e=t;if(!c)return;const n=c.admNo;let a=null;const d={};if(document.querySelectorAll(e(487))[e(395)](t=>{const n=e,o=t[n(617)](n(459));if(o&&"true"===o.value){const e=[];let o=t[n(605)];for(;o&&!o.querySelector(".monthPaid");)e.push({name:o[n(454)][1][n(480)],amount:Number(o[n(454)][2][n(480)][n(590)]("₹",""))}),o=o[n(605)];const s=t[n(454)][0][n(480)];d[s]={fees:e,paid:!0},a=s}}),document[e(442)]("#payRows tr")[e(395)](t=>{const n=e,o=t[n(617)](n(423))?.[n(357)],s=Number(t[n(617)](n(416))?.[n(357)]||0);if(o&&s>0){const t=a;d[t]||(d[t]={fees:[],paid:!0}),d[t][n(536)][n(474)]({name:o,amount:s})}}),0!==Object[e(499)](d)[e(414)])try{await update(ref(db,e(407)+n+e(621)),d);const t=Object.values(d)[e(453)](t=>t[e(536)])[e(432)]((t,n)=>t+n[e(511)],0);let a=document[e(371)](e(560))?.[e(357)]||"₹"+t,s=Number(a[e(590)]("₹",""))||0,r=Number(document[e(371)](e(610))?.[e(357)][e(590)]("₹",""))||0,l=Number(document[e(371)](e(424))?.value[e(590)]("₹",""))||0;let{newOutstanding:u,newAdvance:m}=function(t,n,a,o){const d=e;let s=a,c=o;if(n<t)s=t-n-o+a,o>0&&(c=Math[d(366)](0,o-(t-n)));else if(n>t){let e=n-t;if(a>0){let t=Math[d(455)](e,a);s=a-t,e-=t}e>0&&(c=o+e)}return{newOutstanding:s,newAdvance:c}}(t,s,r,l);document[e(371)](e(610))[e(357)]="₹"+u,document[e(371)](e(424))[e(357)]="₹"+m;const p=push(ref(db,"Payments")),f=p[e(520)];await set(p,{studentID:n,receiptID:f,date:(new Date)[e(415)](),paidAmount:s,selectedTotal:t,outstanding:u,advance:m,paymentMode:document.getElementById("paysMode")?.[e(357)]||"Cash",note:document[e(371)](e(606))?.[e(357)]||"",monthsPaid:Object[e(580)](Object[e(499)](d).map(t=>[t,!0]))}),await update(ref(db,e(407)+n),{outstanding:u,advance:m}),o[e(480)]=e(556),o[e(540)][e(475)]=e(588),o[e(540)].display=e(363),document[e(371)](e(420))[e(357)]=f,o[e(500)]({behavior:e(516),block:e(524)}),setTimeout(()=>o.style[e(599)]=e(413),3e3),await i(n,c[e(394)]),await loadRecentPayments(n)}catch(t){o[e(480)]=e(406)+t[e(456)],o.style[e(599)]="block"}else alert(e(538))})}),window[a0_0x54fca6(450)]("DOMContentLoaded",()=>{loadCollections()}),window[a0_0x54fca6(389)]=generateAdminReport,window[a0_0x54fca6(466)]=exportReportToCSV,window[a0_0x54fca6(469)]=updatePaymentChart;