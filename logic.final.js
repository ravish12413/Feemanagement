function a0_0x61af(t,e){const n=a0_0x204f();return(a0_0x61af=function(t,e){return n[t-=390]})(t,e)}const a0_0xe38926=a0_0x61af;(function(){const t=a0_0x61af,e=a0_0x204f();for(;;)try{if(602159===parseInt(t(396))/1*(-parseInt(t(472))/2)+-parseInt(t(464))/3*(-parseInt(t(456))/4)+-parseInt(t(559))/5*(parseInt(t(511))/6)+parseInt(t(500))/7*(parseInt(t(512))/8)+-parseInt(t(539))/9+parseInt(t(595))/10+parseInt(t(431))/11)break;e.push(e.shift())}catch(t){e.push(e.shift())}})(),console.log(a0_0xe38926(510));import{initializeApp}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";import{getDatabase,ref,set,get,push,update,child}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";const firebaseConfig={apiKey:a0_0xe38926(596),authDomain:a0_0xe38926(467),databaseURL:a0_0xe38926(572),projectId:a0_0xe38926(556),storageBucket:"dbs3-6a018.firebasestorage.app",messagingSenderId:"476698542874",appId:a0_0xe38926(554)},app=initializeApp(firebaseConfig),db=getDatabase(app);function calculateTotal(){const t=a0_0xe38926,e=function(){let t=!0;return function(e,n){const o=t?function(){if(n){const t=n[a0_0x61af(555)](e,arguments);return n=null,t}}:function(){};return t=!1,o}}(),n=e(this,function(){const t=a0_0x61af;return n[t(646)]()[t(470)](t(564))[t(646)]().constructor(n).search(t(564))});n();let o=0;document[t(397)](t(426))[t(579)](e=>{o+=Number(e[t(423)]||0)}),document[t(586)](t(489))[t(492)]="₹"+o}document[a0_0xe38926(573)](a0_0xe38926(514),t=>{const e=a0_0xe38926;if(t.target[e(478)][e(604)](e(415))&&calculateTotal(),t[e(536)].classList[e(604)]("type")){const n=t[e(536)].closest("tr").querySelector(e(475));t[e(536)][e(423)]===e(499)?(n[e(423)]="",n[e(580)][e(440)]=e(408)):n[e(580)][e(440)]=e(550)}if(t.target.classList[e(604)](e(593))){const n=t.target[e(520)](e(497)).querySelector(e(544));"one-time"===t.target[e(423)]?(n[e(423)]="",n.style[e(440)]=e(408)):n[e(580)][e(440)]=e(550)}}),document[a0_0xe38926(586)](a0_0xe38926(613))[a0_0xe38926(573)](a0_0xe38926(442),()=>{const t=a0_0xe38926,e=document[t(534)](t(562)),n=document[t(501)]("tr");n.innerHTML=t(530),e[t(411)](n)});const addFeeBtn=document[a0_0xe38926(586)]("add-fee");async function loadRecentPayments(t){const e=a0_0xe38926,n=document[e(586)](e(568));if(n.innerHTML="",t)try{const o=await get(ref(db,"Payments"));if(!o[e(402)]())return;const a=Object[e(640)](o.val())[e(546)](([e,n])=>n.studentID===t)[e(611)](([t,n],[o,a])=>new Date(a[e(597)])-new Date(n[e(597)]));for(const[o,s]of a){let a=[];if(s[e(528)])for(const n of Object[e(457)](s[e(528)])){const o=await get(ref(db,e(394)+t+e(571)+n+"/fees"));if(o[e(402)]()){const t=o[e(405)]();Object.values(t)[e(579)](t=>{const o=e;a[o(429)](n+o(401)+t[o(599)]+" ₹"+t[o(420)])})}}const d=document.createElement("tr");d.innerHTML="\n                <td>"+(s.receiptID||o)+"</td>\n                <td>"+new Date(s[e(597)]).toLocaleDateString()+e(417)+(a[e(508)](e(577))||"-")+"</td>\n                <td>₹"+(s[e(479)]||0)+e(598)+(s.paidAmount||0)+e(598)+(s[e(516)]||0)+e(598)+(s[e(400)]||0)+e(526)+(s.paidAmount>0?e(392):e(574))+e(561)+(s[e(455)]||o)+e(443),n[e(411)](d)}document.querySelectorAll(e(584))[e(579)](t=>{const n=e;t[n(573)](n(442),()=>printReceipt(t[n(627)].id))})}catch(t){console.error("Error loading recent payments:",t)}}async function printReceipt(t){const e=a0_0xe38926;if(!t)return alert(e(480));const n=await get(ref(db,e(484)+t));if(!n[e(402)]())return alert(e(476));const o=n[e(405)](),a=await get(ref(db,e(394)+o.studentID)),s=a[e(402)]()?a[e(405)]():{};let d="";if(o.monthsPaid)for(const t of Object[e(457)](o[e(528)])){const n=await get(ref(db,"Collected Data/"+o[e(631)]+e(571)+t+"/fees"));if(n[e(402)]()){const o=n.val();Object[e(410)](o)[e(579)](n=>{const o=e;d+=o(529)+t+"</td><td>"+n[o(599)]+o(633)+n[o(420)]+"</td></tr>"})}}const c=window[e(625)]("",e(553)),r=e(403)+t+'</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\n        .header img { height: 60px; }\n        .school-name { font-size: 20px; font-weight: bold; margin-top: 5px; }\n        .school-address { font-size: 12px; }\n        .details { margin-bottom: 20px; }\n        .details table { width: 100%; font-size: 14px; }\n        .details td { padding: 5px; }\n        table.fees { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n        table.fees th, table.fees td { border: 1px solid #000; padding: 8px; text-align: left; }\n        table.fees th { background: #f0f0f0; }\n        .footer { margin-top: 30px; text-align: center; font-size: 12px; border-top: 1px dashed #000; padding-top: 10px; }\n      </style>\n    </head>\n    <body>\n      \x3c!-- HEADER --\x3e\n      <div class="header">\n        <img src="https://via.placeholder.com/100x60?text=Logo" alt="School Logo"/>\n        <div class="school-name">Marsmeta Tech</div>\n        <div class="school-address">123 Main Street, City, State - 123456</div>\n      </div>\n\n      \x3c!-- STUDENT DETAILS --\x3e\n      <div class="details">\n        <table>\n          <tr>\n            <td><b>Student Name:</b> '+(s[e(406)]||o[e(631)])+e(416)+(s[e(427)]||"-")+"</td>\n          </tr>\n          <tr>\n            <td><b>Admission No:</b> "+o.studentID+"</td>\n            <td><b>Receipt ID:</b> "+t+"</td>\n          </tr>\n          <tr>\n            <td><b>Date:</b> "+new Date(o.date)[e(404)]()+e(538)+(o[e(436)]||"-")+e(490)+d+e(585)+o.selectedTotal+e(441)+o[e(624)]+e(390)+o.advance+e(424)+o[e(516)]+'</b></td>\n          </tr>\n          \n        </tbody>\n      </table>\n\n      \x3c!-- FOOTER --\x3e\n      <div class="footer">\n        This is a system generated receipt.<br>\n        Thank you for your payment!<br><br>\n        <i>Authorized Signatory</i>\n      </div>\n    </body>\n    </html>\n    ';c.document.write(r),c.document.close(),c[e(565)]()}async function generateAdminReport(t,e){const n=a0_0xe38926,o=document[n(586)](n(622)),a=document.getElementById("totalStudents"),s=document.getElementById(n(567)),d=document[n(586)](n(468));o[n(581)]="";const c=(await get(ref(db,n(612))))[n(405)]();let r=0,l=0,i=0,u=[],m=[];for(let o in c){const a=c[o];if(!a)continue;const s=a[n(427)][n(496)](n(635),"");if(t&&t!==n(446)&&s!==t)continue;r++;!0===a[n(617)]?.[e]?.[n(418)]?(l++,u[n(429)](n(570)+o+n(607)+a[n(406)]+n(607)+a[n(427)]+'</td>\n        <td style="color:green;">Paid</td>\n      </tr>'),m[n(429)]({admNo:o,name:a[n(406)],class:a.studentClass,status:n(392)})):(i++,u[n(429)](n(570)+o+"</td>\n        <td>"+a[n(406)]+n(607)+a.studentClass+n(493)),m[n(429)]({admNo:o,name:a[n(406)],class:a.studentClass,status:n(576)}))}o[n(581)]=u[n(508)](""),a.textContent=r,s.textContent=l,d[n(492)]=i,window.currentReportData=m,updatePaymentChart(l,i)}function exportReportToCSV(t,e){const n=a0_0xe38926;if(!window[n(393)]||0===window[n(393)].length)return void(document[n(586)]("reportFeedback")[n(492)]=n(421));const o=["Admission Number",n(626),n(465),n(569)],a=window[n(393)][n(413)](t=>[t.admNo,'"'+t[n(599)]+'"',t[n(454)],t[n(628)]]),s=[o[n(508)](","),...a[n(413)](t=>t.join(","))][n(508)]("\n"),d=new Blob([s],{type:"text/csv;charset=utf-8;"}),c=document[n(501)]("a");c.href=URL[n(541)](d),c[n(578)]=n(469)+(t||n(446))+"_"+e+n(557),document.body[n(411)](c),c[n(442)](),document[n(515)].removeChild(c)}function updatePaymentChart(t,e){const n=a0_0xe38926,o=document[n(586)]("paymentChart")[n(398)]("2d");window[n(437)]&&window[n(437)][n(414)](),window[n(437)]=new Chart(o,{type:n(448),data:{labels:[n(392),n(576)],datasets:[{data:[t,e],backgroundColor:["#22c55e","#ef4444"],borderColor:[n(458),n(458)],borderWidth:1}]}})}async function loadCollections(){const t=a0_0xe38926,e=getDatabase(),n=ref(e,t(600)),o=await get(n);let a=0,s=0,d=[];if(o[t(402)]()){const e=o[t(405)](),n=(new Date)[t(563)]()[t(513)](0,10),c=(new Date)[t(563)]()[t(513)](0,7);for(let o in e){const r=e[o];if(!r[t(597)]||!r[t(624)])continue;const l=new Date(r[t(597)])[t(563)](),i=l[t(513)](0,10),u=l[t(513)](0,7);i===n&&(a+=Number(r.paidAmount),d[t(429)]("<li>Admission No: "+r[t(631)]+t(558)+r[t(624)]+"</li>")),u===c&&(s+=Number(r.paidAmount))}}document.querySelectorAll(t(447))[t(579)](e=>e[t(642)]=a),document[t(397)](t(407)).forEach(e=>e[t(642)]=s);document[t(586)](t(638))[t(581)]=d.length?d[t(508)](""):t(542)}function a0_0x204f(){const t=['\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Total</b></td>\n            <td><b>₹',"getElementById","background","from","billingStartMonth","#classFeeTable tbody tr","max","Student not found","sFeeType","type","8497100jvWhYY","AIzaSyBcNxs1qgOUV9QUXyEHNs_gPyZQHGpZ1B8","date","</td>\n                <td>₹","name","Payments","100%","green","searchBtn","contains","Note: Student has advance balance of ₹",'\n    <td><input placeholder="Fee name e.g. Hostel" class="sFeeName" /></td>\n    <td><input type="number" placeholder="Amount" class="sFeeAmount" style="width:80px;" /></td>\n    <td>\n      <select class="sFeeType">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n    </td>\n    <td>\n      <select class="sFeeFrequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </td>\n  ',"</td>\n        <td>","padStart","remove","width","sort","Collected Data","add-more","getFullYear","disabled",".sFeefrequency","paymentsByMonth","admNo",'\n    <td></td>\n    <td><input type="text" class="customFeeName" placeholder="Custom Fee Name"></td>\n    <td><input type="number" class="customFeeAmount" placeholder="Amount"></td>\n    <td><button type="button" class="removeRow">❌</button></td>\n    ',"fees","#fff","reportRows",".monthPaid","paidAmount","open","Name","dataset","status","Please enter Admission Number","exportReportToCSV","studentID","paysMode","</td><td>₹","Student Fee Assigned!","Class ","payBalance","Error fetching student: ","todayPayments","\n          <td></td>\n          <td>","entries",'</td>\n        <td colspan="4">\n          <select class="monthPaid">\n            <option value="false" selected>Not Paid</option>\n            <option value="true">Paid</option>\n          </select> Month Total: ₹',"innerText","session","payRows","/paymentsByMonth","toString",'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Advance</b></td>\n            <td><b>₹',".customFeeName","Paid","currentReportData","Collected Data/","color","1AmoQYc","querySelectorAll","getContext","selectedIndex","advance"," - ","exists","\n    <html>\n    <head>\n      <title>Receipt - ","toLocaleString","val","studentName","#monthCollection","none","Payment recorded!","values","appendChild","studentCard","map","destroy","feeAmount","</td>\n            <td><b>Class:</b> ","</td>\n                <td>","paid","#000","amount","Run the report first to export data.","payFather","value",'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Due</b></td>\n            <td><b>₹',"title","#classFeeTable .feeAmount","studentClass","block","push",".sFeeName","5357198UUVShS","key",".feeName","payTotalReceived","split","paymentMode","paymentChartInstance","payAddRow","Enter Admission No","display",'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Paid</b></td>\n            <td><b>₹',"click",'">Print</button>\n                </td>\n            ',"photo","studentSearch","All","#todayCollection","pie","object","tbody","options","Search student first","Error recording payment: ","class","receiptID","652jbvCng","keys","#ffffff","#studentFeeRows .studentFeeRow","input","setMonth","Loading student...","assignFee","3453OxIiSe","Class","error","dbs3-6a018.firebaseapp.com","unpaidCount","Fee_Report_","search","trim","466618Pqyhkv","true","/fees",".frequency","Payment not found","children","classList","selectedTotal","Invalid receipt ID","studentFeeRows","reduce",".customFeeAmount","Payments/","paySelectedTotal","</td>\n        ","flatMap","FeeStructures/","total_amount",'</td>\n          </tr>\n        </table>\n      </div>\n\n      \x3c!-- FEE DETAILS --\x3e\n      <table class="fees">\n        <thead>\n          <tr>\n            <th>Month</th>\n            <th>Fee Name</th>\n            <th>Amount</th>\n          </tr>\n        </thead>\n        <tbody>\n          ',"getMonth","textContent",'</td>\n        <td style="color:red;">Unpaid</td>\n      </tr>',"clearFee","#payRows tr","replace",".studentFeeRow","fatherName","one-time","1363747HrRCwT","createElement","payReceivedInput","recurring","payOutstanding","min","Class Fee Saved!",'input[placeholder*="Fee name"]',"join","paymentNote","Logic.js loaded","6EzQGXK","8DbweHR","slice","change","body","outstanding",".type",".sFeeType","Yearly","closest","frequency","</td>\n          <td>₹","Warning: Student has previous outstanding of ₹","\n        <td>","Please select a Billing Start Month.","</td>\n                <td>\n                    ","DOMContentLoaded","monthsPaid","<tr><td>",'\n    <td><input type="text" class="feeName" placeholder="Fee name" /></td>\n    <td><input type="number" placeholder="0" class="feeAmount" /></td>\n    <td>\n      <select class="type">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n    </td>\n    <td>\n      <select class="frequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </td>',"Billing start month is locked","updatePaymentChart","/billingStartMonth","querySelector","StudentFees/","target",".removeRow","</td>\n            <td><b>Payment Mode:</b> ","6745833KBsLwV","table","createObjectURL","<li>No payments today</li>","paySearchBtn",".sFeeFrequency","text","filter",".feeAmount","Monthly","default-avatar.png","inline-block","Error assigning fee: ","message","_blank","1:476698542874:web:41c0c69274d5d95a9522a3","apply","dbs3-6a018",".csv"," - ₹","670785cWPrCt","nextElementSibling",'\n                    <button class="btn small recentPrintBtn" data-id="',"#classFeeTable tbody","toISOString","(((.+)+)+)+$","print","dispatchEvent","paidCount","recentPaymentsBody","Payment Status","<tr>\n        <td>","/paymentsByMonth/","https://dbs3-6a018-default-rtdb.firebaseio.com","addEventListener","Pending","payFeedback","Unpaid","<br>","download","forEach","style","innerHTML","length","center",".recentPrintBtn"];return(a0_0x204f=function(){return t})()}addFeeBtn&&addFeeBtn[a0_0xe38926(573)]("click",()=>{const t=a0_0xe38926,e=document[t(586)]("classKey"),n=document[t(586)](t(643));if(!e||!n)return;const o=e[t(451)][e[t(399)]][t(545)],a=(n[t(423)][t(471)](),{});document.querySelectorAll(t(590))[t(579)](e=>{const n=t,o=e.querySelector(n(433)),s=e[n(534)](n(547)),d=e[n(534)](n(517)),c=e[n(534)](".frequency"),r=o?o.value[n(471)]():"",l=s?Number(s[n(423)]||0):0;!r||l<=0||(a[r]={amount:l,type:d?d[n(423)]:"",frequency:c&&c[n(580)][n(440)]!==n(408)?c[n(423)]:""})}),set(ref(db,t(488)+o),a),alert(t(506))}),document[a0_0xe38926(586)](a0_0xe38926(603))[a0_0xe38926(573)]("click",async()=>{const t=a0_0xe38926,e=document[t(586)](t(445))[t(423)][t(471)]();if(!e)return alert(t(439));const n=await get(ref(db,t(394)+e));if(!n.exists())return void alert(t(592));const o=n[t(405)]();document[t(586)](t(412))[t(580)].display=t(428),document.getElementById(t(406)).value=o[t(406)]||"",document[t(586)](t(427))[t(423)]=o[t(427)]||"",document.getElementById(t(498))[t(423)]=o[t(498)]||"";const a=document[t(586)](t(589)),s=await get(ref(db,t(535)+e));s[t(402)]()&&s.val()[t(589)]?(a[t(423)]=s[t(405)]().billingStartMonth,a[t(615)]=!0,a.style[t(587)]="#fff",a.style[t(395)]="#000",a.title=t(531)):(a[t(423)]="",a[t(615)]=!1,a[t(580)].background="",a[t(580)][t(395)]="",a.title="")}),window.addStudentFeeRow=function(){const t=a0_0xe38926,e=document[t(586)](t(481));let n=e[t(534)](t(540));!n&&(n=document[t(501)](t(540)),n.id="studentFeeTable",n[t(580)][t(610)]=t(601),n.style.borderCollapse="collapse",n[t(581)]="\n      <thead>\n        <tr>\n          <th>Fee Name</th>\n          <th>Amount</th>\n          <th>Type</th>\n          <th>Frequency</th>\n        </tr>\n      </thead>\n      <tbody></tbody>\n    ",e[t(411)](n));const o=n.querySelector(t(450)),a=document[t(501)]("tr");a[t(581)]=t(606),o[t(411)](a);const s=a[t(534)](".sFeeType"),d=a.querySelector(t(544));s[t(573)](t(514),()=>{const e=t;s[e(423)]===e(499)?d.style[e(440)]="none":d[e(580)][e(440)]=e(550)}),s[t(566)](new Event(t(514)))},window[a0_0xe38926(463)]=async function(){const t=a0_0xe38926,e=document[t(586)]("studentSearch").value.trim();if(!e)return alert(t(452));const n=document[t(586)](t(589));let o=n[t(423)];const a=ref(db,t(535)+e),s=await get(a);let d={},c=!1;if(s[t(402)]()){const e=s[t(405)]();e[t(620)]&&typeof e[t(620)]===t(449)?d=e[t(620)]:Object.entries(e)[t(579)](([e,n])=>{const o=t;e!==o(589)&&"object"==typeof n&&null!=n[o(420)]&&(d[e]=n)}),e.billingStartMonth?(c=!0,n.value=e.billingStartMonth,o=e.billingStartMonth,n.disabled=!0,n.style.background=t(621),n[t(580)].color=t(419),n[t(425)]=t(531)):n[t(615)]=!1}if(!c&&!o)return void alert(t(525));if([...Array[t(588)](document[t(397)](t(459))),...Array[t(588)](document[t(397)]("#studentFeeRows table tbody tr"))].forEach(e=>{const n=t,o=e.querySelector(n(430))||e[n(534)](n(507)),a=e[n(534)](".sFeeAmount")||e[n(534)]('input[type="number"]'),s=e[n(534)](n(518))||e[n(534)]("select"),c=e.querySelector(n(616))||e.querySelector(n(544)),r=(o?.[n(423)]||"")[n(471)](),l=Number(a?.value||0),i=(s?.[n(423)]||"")[n(471)]().toLowerCase(),u=i===n(503)&&c?c[n(423)]:null;r&&l>0&&(d[r]={amount:l,type:i,frequency:u})}),0===Object.keys(d)[t(582)])return void alert("Please add at least one valid fee before assigning!");const r={[t(535)+e+t(533)]:o,[t(535)+e+t(474)]:d};s.exists()&&!s[t(405)]()[t(620)]&&Object[t(457)](s[t(405)]()||{})[t(579)](n=>{const o=t;"billingStartMonth"!==n&&n!==o(620)&&(r[o(535)+e+"/"+n]=null)});try{await update(ref(db),r),alert(t(634));const e=document[t(586)](t(481));e&&(e[t(581)]=""),n[t(615)]=!0,n[t(580)][t(587)]="#fff",n[t(580)][t(395)]="#000",n[t(425)]="Billing start month is locked"}catch(e){console[t(466)](e),alert(t(551)+e.message)}},window[a0_0xe38926(494)]=function(){const t=a0_0xe38926;document.getElementById(t(481))[t(581)]='\n    <div class="row four studentFeeRow">\n      <input placeholder="Fee name e.g. Transport" class="sFeeName" />\n      <input type="number" placeholder="Amount" class="sFeeAmount" />\n      <select class="sFeeType">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n      <select class="sFeeFrequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </div>'},calculateTotal(),document[a0_0xe38926(573)](a0_0xe38926(527),()=>{const t=a0_0xe38926,e=document[t(586)]("paySearchInput"),n=document[t(586)](t(543)),o=document[t(586)](t(644)),a=document[t(586)](t(575)),s=(document[t(586)](t(502)),document.getElementById("payTotalCalculated"),document[t(586)]("payTotalReceived"),document.getElementById(t(636)),document[t(586)]("payRecord")),d=document[t(586)](t(438));let c=null,r={};async function l(e,n){const s=t;o[s(581)]="",r={};const d=await get(ref(db,s(535)+e));let c=d[s(402)]()?d.val().billingStartMonth:null;if(!c)return a[s(492)]="Billing start month not set for student!",void window.alert("Billing start month not set for student! Please assign student fee first.");const l=await get(ref(db,s(488)+n)),u=l.exists()?l[s(405)]():{},m=function(e){const n=t,o=[],[a,s]=e[n(435)]("-")[n(413)](Number);let d=new Date(a,s-1,1);for(;3!==d[n(491)]()||d[n(614)]()!==a+1;){const t=d[n(614)]()+"-"+String(d[n(491)]()+1)[n(608)](2,"0");o[n(429)](t),d[n(461)](d[n(491)]()+1)}return o}(c);if(m[s(579)](t=>{const e=s;r[t]=[];for(const[n,o]of Object[e(640)](u)){const a=o[e(521)]||e(499),s=a===e(548),d=a===e(519)||a===e(499);(s||d&&t===c)&&r[t][e(429)]({name:n,amount:o.amount})}}),d[s(402)]()){const t=d[s(405)]()[s(620)]||{};for(const[e,n]of Object[s(640)](t))m[s(579)](t=>{const o=s,a=n[o(594)]===o(503),d=n[o(594)]===o(499);(a||d&&t===c)&&r[t].push({name:e,amount:n[o(420)]})})}const p=await get(ref(db,s(394)+e+s(645))),f=p.exists()?p[s(405)]():{};for(const t of Object[s(457)](r))f[t]?.paid&&delete r[t];for(const[t,e]of Object[s(640)](r)){if(0===e.length)continue;const n=e[s(482)]((t,e)=>t+e[s(420)],0),a=document[s(501)]("tr");a[s(581)]=s(524)+t+s(641)+n+"\n        </td>\n      ",o[s(411)](a),e.forEach(t=>{const e=s,n=document[e(501)]("tr");n[e(581)]=e(639)+t[e(599)]+e(522)+t.amount+e(486),o.appendChild(n)}),a[s(534)](s(623)).addEventListener(s(514),t=>i())}const y=(await get(ref(db,"Collected Data/"+e)))[s(405)](),b=y?.[s(516)]||0,h=y?.advance||0;b>0&&alert(s(523)+b),h>0&&alert(s(605)+h),i()}function i(){const e=t;let n=0,o=0,a=Number(document.getElementById(e(504))[e(423)][e(496)]("₹",""))||0,s=Number(document[e(586)](e(400))[e(423)][e(496)]("₹",""))||0,d=s;document[e(397)]("#payRows tr").forEach(t=>{const a=e,s=t.querySelector(".monthPaid");if(s){let e=0,d=t[a(560)];for(;d&&!d.querySelector(a(623));){e+=Number(d[a(477)][2][a(492)][a(496)]("₹",""))||0,d=d[a(560)]}n+=e,s.value===a(473)&&(o+=e)}const d=t.querySelector(a(483));if(d){const t=Number(d[a(423)]||0);n+=t,t>0&&(o+=t)}}),document[e(586)]("payTotalCalculated").value="₹"+n,document[e(586)](e(485))[e(423)]="₹"+o;let c=o;document.getElementById("payTotalReceived")[e(423)]="₹"+c;let r=a;if(c<o)r=o-c-s+a,s>0&&(d=Math[e(591)](0,s-(o-c)));else if(c>o){let t=c-o;if(a>0){let n=Math[e(505)](t,a);r=a-n,t-=n}t>0&&(d=s+t)}document[e(586)](e(504))[e(423)]="₹"+r,document[e(586)]("advance").value="₹"+d,document.getElementById(e(636))[e(423)]="₹"+(o-c)}n[t(573)](t(442),async()=>{const n=t,o=e[n(423)][n(471)]();if(!o)return a[n(492)]=n(629),void(a[n(580)][n(440)]="block");a.textContent=n(462),a[n(580)][n(440)]=n(428);try{const t=await get(ref(db,n(394)+o));if(await loadRecentPayments(o),!t.exists())return void(a[n(492)]=n(592));const e=t[n(405)]();c={admNo:o,...e},document[n(586)]("payStudent")[n(423)]=e[n(406)]||"",document.getElementById("payClass")[n(423)]=e[n(427)]||"",document[n(586)](n(422))[n(423)]=e[n(498)]||"",document[n(586)]("payPhoto").src=e[n(444)]||n(549),document[n(586)](n(504))[n(423)]="₹"+(e[n(516)]||0),document[n(586)]("advance")[n(423)]="₹"+(e[n(400)]||0),await l(o,e[n(427)]),a.style[n(440)]=n(408)}catch(t){a[n(492)]=n(637)+t[n(552)],a.style.display=n(428)}}),document.getElementById(t(434))[t(573)](t(460),function(){const e=t;let n=Number(document[e(586)]("paySelectedTotal")[e(423)][e(496)]("₹",""))||0,o=Number(this[e(423)][e(496)]("₹",""))||0;document[e(586)](e(636))[e(423)]="₹"+(n-o)}),d[t(573)](t(442),()=>{const e=t,n=document[e(501)]("tr");n.innerHTML=e(619),o[e(411)](n),n[e(534)](e(483))[e(573)](e(460),i),n[e(534)](".customFeeName").addEventListener(e(460),i),n[e(534)](e(537))[e(573)]("click",()=>{n[e(609)](),i()})}),s[t(573)]("click",async()=>{const e=t;if(!c)return;const n=c[e(618)];let o=null;const s={};if(document[e(397)](e(495))[e(579)](t=>{const n=e,a=t[n(534)](".monthPaid");if(a&&a[n(423)]===n(473)){const e=[];let a=t[n(560)];for(;a&&!a[n(534)](".monthPaid");)e[n(429)]({name:a[n(477)][1][n(492)],amount:Number(a[n(477)][2][n(492)][n(496)]("₹",""))}),a=a.nextElementSibling;const d=t.children[0][n(492)];s[d]={fees:e,paid:!0},o=d}}),document.querySelectorAll(e(495)).forEach(t=>{const n=e,a=t[n(534)](n(391))?.[n(423)],d=Number(t[n(534)](n(483))?.[n(423)]||0);if(a&&d>0){const t=o;s[t]||(s[t]={fees:[],paid:!0}),s[t].fees[n(429)]({name:a,amount:d})}}),0!==Object[e(457)](s)[e(582)])try{await update(ref(db,e(394)+n+e(645)),s);const t=Object[e(410)](s)[e(487)](t=>t[e(620)])[e(482)]((t,n)=>t+n[e(420)],0);let o=document[e(586)]("payTotalReceived")?.[e(423)]||"₹"+t,d=Number(o.replace("₹",""))||0,r=Number(document.getElementById(e(504))?.[e(423)].replace("₹",""))||0,i=Number(document[e(586)]("advance")?.[e(423)][e(496)]("₹",""))||0;let{newOutstanding:u,newAdvance:m}=function(t,n,o,a){const s=e;let d=o,c=a;if(n<t)d=t-n-a+o,a>0&&(c=Math[s(591)](0,a-(t-n)));else if(n>t){let e=n-t;if(o>0){let t=Math[s(505)](e,o);d=o-t,e-=t}e>0&&(c=a+e)}return{newOutstanding:d,newAdvance:c}}(t,d,r,i);document.getElementById(e(504)).value="₹"+u,document[e(586)](e(400))[e(423)]="₹"+m;const p=push(ref(db,e(600))),f=p[e(432)];await set(p,{studentID:n,receiptID:f,date:(new Date)[e(563)](),paidAmount:d,selectedTotal:t,outstanding:u,advance:m,paymentMode:document[e(586)](e(632))?.[e(423)]||"Cash",note:document[e(586)](e(509))?.[e(423)]||"",monthsPaid:Object.fromEntries(Object[e(457)](s)[e(413)](t=>[t,!0]))}),await update(ref(db,e(394)+n),{outstanding:u,advance:m}),a.textContent=e(409),a[e(580)][e(395)]=e(602),a[e(580)][e(440)]=e(428),document.getElementById("payReceiptID")[e(423)]=f,a.scrollIntoView({behavior:"smooth",block:e(583)}),setTimeout(()=>a.style[e(440)]=e(408),3e3),await l(n,c[e(427)]),await loadRecentPayments(n)}catch(t){a[e(492)]=e(453)+t[e(552)],a[e(580)].display=e(428)}else alert("No payments selected.")})}),window[a0_0xe38926(573)](a0_0xe38926(527),()=>{loadCollections()}),window.generateAdminReport=generateAdminReport,window[a0_0xe38926(630)]=exportReportToCSV,window[a0_0xe38926(532)]=updatePaymentChart;