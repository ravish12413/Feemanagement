function a0_0x3b36(){const e=["/billingStartMonth","createObjectURL","object","color","toLocaleString","href","</td>\n          </tr>\n          <tr>\n            <td><b>Admission No:</b> ",'\n    <div class="row four studentFeeRow">\n      <input placeholder="Fee name e.g. Transport" class="sFeeName" />\n      <input type="number" placeholder="Amount" class="sFeeAmount" />\n      <select class="sFeeType">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n      <select class="sFeeFrequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </div>',"#fff","Note: Student has advance balance of ₹","#000","addStudentFeeRow","\n      <thead>\n        <tr>\n          <th>Fee Name</th>\n          <th>Amount</th>\n          <th>Type</th>\n          <th>Frequency</th>\n        </tr>\n      </thead>\n      <tbody></tbody>\n    ","scrollIntoView",'\n    <td><input placeholder="Fee name e.g. Hostel" class="sFeeName" /></td>\n    <td><input type="number" placeholder="Amount" class="sFeeAmount" style="width:80px;" /></td>\n    <td>\n      <select class="sFeeType">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n    </td>\n    <td>\n      <select class="sFeeFrequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </td>\n  ',"destroy","Student activated successfully!","DOMContentLoaded","search","Billing start month not set for student! Please assign student fee first.","join","/paymentsByMonth","change","2610HsncuS","add-more","<li>No payments today</li>","All",'">Print</button>\n                </td>\n            ',"recentPaymentsBody","addEventListener","payPhoto","toISOString","dispatchEvent","innerText","</td>\n                <td>",".sFeeFrequency","studentFeeTable","recurring",'</td>\n        <td style="color:red;">Unpaid</td>\n      </tr>',"querySelectorAll","paidCount","paidAmount","trim",".studentFeeRow","exportReportToCSV","#todayCollection","</td>\n          </tr>\n          <tr>\n            <td><b>Date:</b> ",'</td>\n          </tr>\n        </table>\n      </div>\n\n      \x3c!-- FEE DETAILS --\x3e\n      <table class="fees">\n        <thead>\n          <tr>\n            <th>Month</th>\n            <th>Fee Name</th>\n            <th>Amount</th>\n          </tr>\n        </thead>\n        <tbody>\n          ',"Invalid receipt ID","Payment not found","monthsPaid","Loading student...","none","<br>","</td>\n        ","#classFeeTable .feeAmount","closest","values","payOutstanding","#studentFeeRows .studentFeeRow","options","collapse","exists","length","</td>\n            <td><b>Payment Mode:</b> ","89048wCdrHw","sort",".customFeeAmount","selectedTotal","text","center","Payments","tbody","studentClass","fees","innerHTML","Run the report first to export data.","</li>","4388ODonQH",'\n    <td><input type="text" class="feeName" placeholder="Fee name" /></td>\n    <td><input type="number" placeholder="0" class="feeAmount" /></td>\n    <td>\n      <select class="type">\n        <option value="recurring">Recurring</option>\n        <option value="one-time">One-time</option>\n      </select>\n    </td>\n    <td>\n      <select class="frequency">\n        <option value="Monthly">Monthly</option>\n        <option value="Term">Term</option>\n        <option value="Yearly">Yearly</option>\n      </select>\n    </td>',"</td>\n                <td>\n                    ","photo",".sFeeName","replace","push","children","map","billingStartMonth","filter","Error loading recent payments:","max","table","add-fee","Payments/",".type","status","value"," Fees assigned.","dbs3-6a018.firebaseapp.com",".csv",'\n    <td></td>\n    <td><input type="text" class="customFeeName" placeholder="Custom Fee Name"></td>\n    <td><input type="number" class="customFeeAmount" placeholder="Amount"></td>\n    <td><button type="button" class="removeRow">❌</button></td>\n    ',"borderCollapse","\n        </td>\n      ",'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Due</b></td>\n            <td><b>₹',"removeChild","Yearly","</td>\n          <td>₹","selectedIndex","#classFeeTable tbody tr","Please select a Billing Start Month.",'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Paid</b></td>\n            <td><b>₹',"textContent","total_amount","Pending",".customFeeName","val","</td>\n                <td>₹","paymentChart","getContext","reportFeedback","title","Collected Data/","AIzaSyBcNxs1qgOUV9QUXyEHNs_gPyZQHGpZ1B8","Paid","appendChild","paySearchInput","payBalance","https://dbs3-6a018-default-rtdb.firebaseio.com","#monthCollection","display",'\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Total</b></td>\n            <td><b>₹',"/fees","unpaidCount","FeeStructures/","paymentsByMonth","sFeeType","getMonth","22759yrBvMS","width","session","frequency",".recentPrintBtn","Student not found","pie","download"," - ₹","#classFeeTable tbody","block","receiptID","_blank","print","<tr><td>","true","Logic.js loaded","message","paysMode",".sFeeAmount","Billing start month is locked","Name","payReceivedInput","Fee_Report_","toString","2910AYLzka","Cash","min","getFullYear","fatherName","searchBtn","#payRows tr","querySelector","</td>\n        <td>","target",'</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }\n        .header img { height: 60px; }\n        .school-name { font-size: 20px; font-weight: bold; margin-top: 5px; }\n        .school-address { font-size: 12px; }\n        .details { margin-bottom: 20px; }\n        .details table { width: 100%; font-size: 14px; }\n        .details td { padding: 5px; }\n        table.fees { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n        table.fees th, table.fees td { border: 1px solid #000; padding: 8px; text-align: left; }\n        table.fees th { background: #f0f0f0; }\n        .footer { margin-top: 30px; text-align: center; font-size: 12px; border-top: 1px dashed #000; padding-top: 10px; }\n      </style>\n    </head>\n    <body>\n      \x3c!-- HEADER --\x3e\n      <div class="header">\n        <img src="https://via.placeholder.com/100x60?text=Logo" alt="School Logo"/>\n        <div class="school-name">Marsmeta Tech</div>\n        <div class="school-address">123 Main Street, City, State - 123456</div>\n      </div>\n\n      \x3c!-- STUDENT DETAILS --\x3e\n      <div class="details">\n        <table>\n          <tr>\n            <td><b>Student Name:</b> ',"body","5168BWhVaf","(((.+)+)+)+$",".frequency","Class ","toLocaleDateString","advance","click","clearFee","Enter Admission No","dbs3-6a018.firebasestorage.app","payAddRow","Error recording payment: ","<tr>\n        <td>","#ef4444","Billing start month not set for student!","</td><td>₹","nextElementSibling","from","updatePaymentChart","amount","type","\n                <td>",'input[type="number"]',"\n          <td></td>\n          <td>","flatMap","slice","261ECwggy","</td><td>","paymentChartInstance","Payment Status","studentCard","input","studentName","dbs3-6a018","studentID","setMonth","paymentMode","open","#studentFeeRows table tbody tr","green","/paymentsByMonth/","forEach","outstanding",".sFeefrequency","476698542874","payFeedback","remove","split","one-time","text/csv;charset=utf-8;","classKey","Admission Number","select",'</td>\n        <td colspan="4">\n          <select class="monthPaid">\n            <option value="false" selected>Not Paid</option>\n            <option value="true">Paid</option>\n          </select> Month Total: ₹',"studentFeeRows","date","Error fetching student: ","name","contains","entries","src","Monthly"," - ","5798doJeeI","payRows","currentReportData","</td>\n            <td><b>Receipt ID:</b> ","payClass",'</td>\n        <td style="color:green;">Paid</td>\n      </tr>',"StudentFees/","feeAmount","paySelectedTotal",'\n                    <button class="btn small recentPrintBtn" data-id="',"createElement","15ybgJFO","disabled","getElementById","No payments selected.","background","inline-block","error","435603YhWxgs","1040790JHrthm","padStart","studentSearch","keys","close","payTotalCalculated",".feeAmount","100%","classList","payTotalReceived","style","Unpaid","Collected Data","paid","reportRows",".monthPaid"];return(a0_0x3b36=function(){return e})()}const a0_0x1898ea=a0_0x3eb9;function a0_0x3eb9(e,t){const n=a0_0x3b36();return(a0_0x3eb9=function(e,t){return n[e-=293]})(e,t)}(function(){const e=a0_0x3eb9,t=a0_0x3b36();for(;;)try{if(137047===parseInt(e(358))/1+-parseInt(e(530))/2*(parseInt(e(493))/3)+parseInt(e(371))/4*(-parseInt(e(541))/5)+-parseInt(e(549))/6+parseInt(e(548))/7+-parseInt(e(467))/8*(parseInt(e(316))/9)+-parseInt(e(455))/10*(-parseInt(e(430))/11))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(),console.log(a0_0x1898ea(446));import{initializeApp}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";import{getDatabase,ref,set,get,push,update,child}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";const firebaseConfig={apiKey:a0_0x1898ea(415),authDomain:a0_0x1898ea(391),databaseURL:a0_0x1898ea(420),projectId:a0_0x1898ea(500),storageBucket:a0_0x1898ea(476),messagingSenderId:a0_0x1898ea(511),appId:"1:476698542874:web:41c0c69274d5d95a9522a3"},app=initializeApp(firebaseConfig),db=getDatabase(app);function calculateTotal(){const e=a0_0x1898ea,t=function(){let e=!0;return function(t,n){const a=e?function(){if(n){const e=n.apply(t,arguments);return n=null,e}}:function(){};return e=!1,a}}(),n=t(this,function(){const e=a0_0x3eb9;return n[e(454)]()[e(311)]("(((.+)+)+)+$")[e(454)]().constructor(n)[e(311)](e(468))});n();let a=0;document[e(332)](e(348))[e(508)](e=>{a+=Number(e.value||0)}),document.getElementById(e(405))[e(404)]="₹"+a}document.addEventListener(a0_0x1898ea(315),e=>{const t=a0_0x1898ea;if(e[t(464)][t(557)][t(525)](t(537))&&calculateTotal(),e.target.classList[t(525)](t(487))){const n=e[t(464)][t(349)]("tr")[t(462)](t(469));e[t(464)][t(389)]===t(515)?(n.value="",n[t(559)][t(422)]="none"):n.style.display=t(546)}if(e.target[t(557)][t(525)](t(428))){const n=e[t(464)][t(349)](t(336))[t(462)](t(328));e.target[t(389)]===t(515)?(n[t(389)]="",n[t(559)][t(422)]=t(345)):n[t(559)][t(422)]=t(546)}}),document[a0_0x1898ea(543)](a0_0x1898ea(317)).addEventListener(a0_0x1898ea(473),()=>{const e=a0_0x1898ea,t=document.querySelector(e(439)),n=document[e(540)]("tr");n[e(368)]=e(372),t[e(417)](n)});const addFeeBtn=document[a0_0x1898ea(543)](a0_0x1898ea(385));async function loadRecentPayments(e){const t=a0_0x1898ea,n=document[t(543)](t(321));if(n[t(368)]="",e)try{const a=await get(ref(db,"Payments"));if(!a.exists())return;const o=Object.entries(a[t(408)]())[t(381)](([n,a])=>a[t(501)]===e)[t(359)](([e,t],[n,a])=>new Date(a.date)-new Date(t.date));for(const[a,d]of o){let o=[];if(d[t(343)])for(const n of Object[t(552)](d.monthsPaid)){const a=await get(ref(db,t(414)+e+t(507)+n+t(424)));if(a[t(355)]()){const e=a[t(408)]();Object.values(e)[t(508)](e=>{const a=t;o.push(n+a(529)+e.name+" ₹"+e[a(486)])})}}const s=document[t(540)]("tr");s.innerHTML=t(488)+(d.receiptID||a)+t(327)+new Date(d[t(522)])[t(471)]()+t(327)+(o.join(t(346))||"-")+t(409)+(d[t(361)]||0)+t(409)+(d.paidAmount||0)+"</td>\n                <td>₹"+(d.outstanding||0)+t(409)+(d[t(472)]||0)+t(373)+(d[t(334)]>0?t(416):t(406))+t(539)+(d[t(441)]||a)+t(320),n[t(417)](s)}document.querySelectorAll(t(434))[t(508)](e=>{const n=t;e[n(322)](n(473),()=>printReceipt(e.dataset.id))})}catch(e){console[t(547)](t(382),e)}}async function printReceipt(e){const t=a0_0x1898ea;if(!e)return alert(t(341));const n=await get(ref(db,t(386)+e));if(!n[t(355)]())return alert(t(342));const a=n[t(408)](),o=await get(ref(db,t(414)+a.studentID)),d=o[t(355)]()?o[t(408)]():{};let s="";if(a[t(343)])for(const e of Object[t(552)](a.monthsPaid)){const n=await get(ref(db,t(414)+a[t(501)]+t(507)+e+"/fees"));if(n[t(355)]()){const a=n[t(408)]();Object[t(350)](a)[t(508)](n=>{const a=t;s+=a(444)+e+a(494)+n[a(524)]+a(482)+n[a(486)]+"</td></tr>"})}}const c=window[t(504)]("",t(442)),r="\n    <html>\n    <head>\n      <title>Receipt - "+e+t(465)+(d.studentName||a.studentID)+"</td>\n            <td><b>Class:</b> "+(d[t(366)]||"-")+t(299)+a[t(501)]+t(533)+e+t(339)+new Date(a.date)[t(297)]()+t(357)+(a[t(503)]||"-")+t(340)+s+t(423)+a[t(361)]+t(403)+a[t(334)]+'</b></td>\n          </tr>\n          <tr>\n            <td colspan="2" style="text-align:right;"><b>Advance</b></td>\n            <td><b>₹'+a[t(472)]+t(396)+a[t(509)]+'</b></td>\n          </tr>\n          \n        </tbody>\n      </table>\n\n      \x3c!-- FOOTER --\x3e\n      <div class="footer">\n        This is a system generated receipt.<br>\n        Thank you for your payment!<br><br>\n        <i>Authorized Signatory</i>\n      </div>\n    </body>\n    </html>\n    ';c.document.write(r),c.document[t(553)](),c[t(443)]()}async function generateAdminReport(e,t){const n=a0_0x1898ea,a=document[n(543)](n(563)),o=document.getElementById("totalStudents"),d=document[n(543)](n(333)),s=document.getElementById(n(425));a[n(368)]="";const c=(await get(ref(db,n(561))))[n(408)]();let r=0,i=0,l=0,u=[],m=[];for(let a in c){const o=c[a];if(!o)continue;const d=o[n(366)].replace(n(470),"");if(e&&e!==n(319)&&d!==e)continue;r++;!0===o[n(427)]?.[t]?.[n(562)]?(i++,u[n(377)](n(479)+a+n(463)+o[n(499)]+n(463)+o.studentClass+n(535)),m.push({admNo:a,name:o[n(499)],class:o[n(366)],status:"Paid"})):(l++,u[n(377)](n(479)+a+n(463)+o[n(499)]+n(463)+o[n(366)]+n(331)),m[n(377)]({admNo:a,name:o[n(499)],class:o.studentClass,status:n(560)}))}a.innerHTML=u[n(313)](""),o[n(404)]=r,d.textContent=i,s[n(404)]=l,window[n(532)]=m,updatePaymentChart(i,l)}function exportReportToCSV(e,t){const n=a0_0x1898ea;if(!window[n(532)]||0===window[n(532)][n(356)])return void(document.getElementById(n(412))[n(404)]=n(369));const a=[n(518),n(451),"Class",n(496)],o=window.currentReportData[n(379)](e=>[e.admNo,'"'+e.name+'"',e.class,e[n(388)]]),d=[a[n(313)](","),...o[n(379)](e=>e.join(","))][n(313)]("\n"),s=new Blob([d],{type:n(516)}),c=document[n(540)]("a");c[n(298)]=URL[n(294)](s),c[n(437)]=n(453)+(e||n(319))+"_"+t+n(392),document[n(466)].appendChild(c),c.click(),document[n(466)][n(397)](c)}function updatePaymentChart(e,t){const n=a0_0x1898ea,a=document[n(543)](n(410))[n(411)]("2d");window[n(495)]&&window[n(495)][n(308)](),window.paymentChartInstance=new Chart(a,{type:n(436),data:{labels:[n(416),n(560)],datasets:[{data:[e,t],backgroundColor:["#22c55e",n(480)],borderColor:["#ffffff","#ffffff"],borderWidth:1}]}})}async function loadCollections(){const e=a0_0x1898ea,t=getDatabase(),n=ref(t,e(364)),a=await get(n);let o=0,d=0,s=[];if(a[e(355)]()){const t=a[e(408)](),n=(new Date).toISOString()[e(492)](0,10),c=(new Date)[e(324)]().slice(0,7);for(let a in t){const r=t[a];if(!r[e(522)]||!r[e(334)])continue;const i=new Date(r.date)[e(324)](),l=i[e(492)](0,10),u=i[e(492)](0,7);l===n&&(o+=Number(r[e(334)]),s[e(377)]("<li>Admission No: "+r.studentID+e(438)+r[e(334)]+e(370))),u===c&&(d+=Number(r[e(334)]))}}document[e(332)](e(338)).forEach(t=>t[e(326)]=o),document[e(332)](e(421))[e(508)](e=>e.innerText=d);document[e(543)]("todayPayments")[e(368)]=s.length?s.join(""):e(318)}addFeeBtn&&addFeeBtn[a0_0x1898ea(322)]("click",()=>{const e=a0_0x1898ea,t=document[e(543)](e(517)),n=document[e(543)](e(432));if(!t||!n)return;const a=t[e(353)][t[e(400)]][e(362)],o=(n[e(389)][e(335)](),{});document.querySelectorAll(e(401))[e(508)](t=>{const n=e,a=t[n(462)](".feeName"),d=t.querySelector(n(555)),s=t[n(462)](n(387)),c=t.querySelector(n(469)),r=a?a.value.trim():"",i=d?Number(d.value||0):0;!r||i<=0||(o[r]={amount:i,type:s?s[n(389)]:"",frequency:c&&c[n(559)][n(422)]!==n(345)?c[n(389)]:""})}),set(ref(db,e(426)+a),o),alert("Class Fee Saved!")}),document[a0_0x1898ea(543)](a0_0x1898ea(460))[a0_0x1898ea(322)]("click",async()=>{const e=a0_0x1898ea,t=document.getElementById(e(551))[e(389)].trim();if(!t)return alert(e(475));const n=await get(ref(db,"Collected Data/"+t));if(!n[e(355)]())return void alert(e(435));const a=n[e(408)]();document[e(543)](e(497))[e(559)][e(422)]=e(440),document.getElementById("studentName")[e(389)]=a[e(499)]||"",document[e(543)](e(366))[e(389)]=a.studentClass||"",document[e(543)](e(459))[e(389)]=a.fatherName||"";const o=document[e(543)](e(380)),d=await get(ref(db,"StudentFees/"+t));d[e(355)]()&&d[e(408)]()[e(380)]?(o[e(389)]=d[e(408)]()[e(380)],o[e(542)]=!0,o[e(559)][e(545)]="#fff",o[e(559)][e(296)]=e(303),o.title=e(450)):(o[e(389)]="",o[e(542)]=!1,o[e(559)].background="",o.style[e(296)]="",o[e(413)]="")}),window[a0_0x1898ea(304)]=function(){const e=a0_0x1898ea,t=document.getElementById(e(521));let n=t[e(462)](e(384));!n&&(n=document[e(540)]("table"),n.id=e(329),n[e(559)][e(431)]=e(556),n[e(559)][e(394)]=e(354),n.innerHTML=e(305),t[e(417)](n));const a=n.querySelector(e(365)),o=document.createElement("tr");o[e(368)]=e(307),a[e(417)](o);const d=o[e(462)](".sFeeType"),s=o[e(462)](e(328));d[e(322)](e(315),()=>{const t=e;d[t(389)]===t(515)?s[t(559)][t(422)]=t(345):s[t(559)].display="inline-block"}),d[e(325)](new Event("change"))},window.assignFee=async function(){const e=a0_0x1898ea,t=document[e(543)](e(551))[e(389)][e(335)]();if(!t)return alert("Search student first");const n=document[e(543)](e(380));let a=n[e(389)];const o=ref(db,e(536)+t),d=await get(o);let s={},c=!1;if(d[e(355)]()){const t=d.val();t[e(367)]&&typeof t[e(367)]===e(295)?s=t.fees:Object.entries(t).forEach(([t,n])=>{"billingStartMonth"!==t&&typeof n===e(295)&&null!=n.amount&&(s[t]=n)}),t[e(380)]?(c=!0,n[e(389)]=t[e(380)],a=t[e(380)],n.disabled=!0,n.style[e(545)]="#fff",n[e(559)][e(296)]=e(303),n[e(413)]=e(450)):n.disabled=!1}if(!c&&!a)return void alert(e(402));[...Array[e(484)](document.querySelectorAll(e(352))),...Array.from(document.querySelectorAll(e(505)))][e(508)](t=>{const n=e,a=t[n(462)](n(375))||t[n(462)]('input[placeholder*="Fee name"]'),o=t[n(462)](n(449))||t[n(462)](n(489)),d=t[n(462)](".sFeeType")||t.querySelector(n(519)),c=t[n(462)](n(510))||t[n(462)](n(328)),r=(a?.[n(389)]||"")[n(335)](),i=Number(o?.[n(389)]||0),l=(d?.[n(389)]||"").trim().toLowerCase(),u="recurring"===l&&c?c.value:null;r&&i>0&&(s[r]={amount:i,type:l,frequency:u})});const r={["StudentFees/"+t+e(293)]:a};Object[e(552)](s)[e(356)]>0&&(r[e(536)+t+"/fees"]=s),d.exists()&&!d[e(408)]()[e(367)]&&Object.keys(d[e(408)]()||{}).forEach(n=>{const a=e;n!==a(380)&&n!==a(367)&&(r["StudentFees/"+t+"/"+n]=null)});try{await update(ref(db),r),alert(e(309)+(Object.keys(s)[e(356)]>0?e(390):""));const t=document.getElementById(e(521));t&&(t[e(368)]=""),n[e(542)]=!0,n.style[e(545)]=e(301),n[e(559)][e(296)]="#000",n[e(413)]=e(450)}catch(t){console.error(t),alert("Error assigning fee: "+t[e(447)])}},window[a0_0x1898ea(474)]=function(){const e=a0_0x1898ea;document[e(543)](e(521))[e(368)]=e(300)},calculateTotal(),document[a0_0x1898ea(322)](a0_0x1898ea(310),()=>{const e=a0_0x1898ea,t=document[e(543)](e(418)),n=document[e(543)]("paySearchBtn"),a=document.getElementById(e(531)),o=document[e(543)](e(512)),d=(document[e(543)](e(452)),document.getElementById("payTotalCalculated"),document[e(543)](e(558)),document[e(543)](e(419)),document[e(543)]("payRecord")),s=document.getElementById(e(477));let c=null,r={};async function i(t,n){const d=e;a[d(368)]="",r={};const s=await get(ref(db,d(536)+t));let c=s[d(355)]()?s.val()[d(380)]:null;if(!c)return o[d(404)]=d(481),void window.alert(d(312));const i=await get(ref(db,d(426)+n)),u=i[d(355)]()?i[d(408)]():{},m=function(t){const n=e,a=[],[o,d]=t[n(514)]("-")[n(379)](Number);let s=new Date(o,d-1,1);for(;3!==s[n(429)]()||s[n(458)]()!==o+1;){const e=s[n(458)]()+"-"+String(s.getMonth()+1)[n(550)](2,"0");a[n(377)](e),s[n(502)](s[n(429)]()+1)}return a}(c);if(m[d(508)](e=>{const t=d;r[e]=[];for(const[n,a]of Object[t(526)](u)){const o=a[t(433)]||t(515),d=o===t(528),s=o===t(398)||o===t(515);(d||s&&e===c)&&r[e][t(377)]({name:n,amount:a[t(486)]})}}),s[d(355)]()){const e=s.val()[d(367)]||{};for(const[t,n]of Object[d(526)](e))m[d(508)](e=>{const a=d,o=n[a(487)]===a(330),s="one-time"===n[a(487)];(o||s&&e===c)&&r[e][a(377)]({name:t,amount:n.amount})})}const p=await get(ref(db,d(414)+t+d(314))),f=p[d(355)]()?p[d(408)]():{};for(const e of Object[d(552)](r))f[e]?.paid&&delete r[e];for(const[e,t]of Object.entries(r)){if(0===t[d(356)])continue;const n=t.reduce((e,t)=>e+t.amount,0),o=document[d(540)]("tr");o[d(368)]="\n        <td>"+e+d(520)+n+d(395),a[d(417)](o),t[d(508)](e=>{const t=d,n=document[t(540)]("tr");n.innerHTML=t(490)+e[t(524)]+t(399)+e.amount+t(347),a[t(417)](n)}),o[d(462)](d(564))[d(322)](d(315),e=>l())}const y=(await get(ref(db,d(414)+t)))[d(408)](),b=y?.[d(509)]||0,h=y?.[d(472)]||0;b>0&&alert("Warning: Student has previous outstanding of ₹"+b),h>0&&alert(d(302)+h),l()}function l(){const t=e;let n=0,a=0,o=Number(document.getElementById(t(351))[t(389)][t(376)]("₹",""))||0,d=Number(document.getElementById(t(472))[t(389)][t(376)]("₹",""))||0,s=d;document[t(332)]("#payRows tr")[t(508)](e=>{const o=t,d=e[o(462)](o(564));if(d){let t=0,s=e[o(483)];for(;s&&!s[o(462)](o(564));){t+=Number(s.children[2][o(404)].replace("₹",""))||0,s=s[o(483)]}n+=t,d[o(389)]===o(445)&&(a+=t)}const s=e[o(462)](o(360));if(s){const e=Number(s[o(389)]||0);n+=e,e>0&&(a+=e)}}),document[t(543)](t(554))[t(389)]="₹"+n,document[t(543)]("paySelectedTotal")[t(389)]="₹"+a;let c=a;document[t(543)](t(558))[t(389)]="₹"+c;let r=o;if(c<a)r=a-c-d+o,d>0&&(s=Math[t(383)](0,d-(a-c)));else if(c>a){let e=c-a;if(o>0){let n=Math[t(457)](e,o);r=o-n,e-=n}e>0&&(s=d+e)}document.getElementById("payOutstanding")[t(389)]="₹"+r,document[t(543)](t(472))[t(389)]="₹"+s,document[t(543)](t(419))[t(389)]="₹"+(a-c)}n[e(322)](e(473),async()=>{const n=e,a=t[n(389)].trim();if(!a)return o.textContent="Please enter Admission Number",void(o[n(559)].display="block");o[n(404)]=n(344),o[n(559)].display=n(440);try{const e=await get(ref(db,n(414)+a));if(await loadRecentPayments(a),!e[n(355)]())return void(o[n(404)]="Student not found");const t=e[n(408)]();c={admNo:a,...t},document[n(543)]("payStudent")[n(389)]=t[n(499)]||"",document[n(543)](n(534))[n(389)]=t[n(366)]||"",document.getElementById("payFather").value=t[n(459)]||"",document[n(543)](n(323))[n(527)]=t[n(374)]||"default-avatar.png",document[n(543)](n(351))[n(389)]="₹"+(t[n(509)]||0),document[n(543)]("advance")[n(389)]="₹"+(t[n(472)]||0),await i(a,t[n(366)]),o[n(559)][n(422)]="none"}catch(e){o[n(404)]=n(523)+e.message,o[n(559)][n(422)]=n(440)}}),document[e(543)]("payTotalReceived")[e(322)](e(498),function(){const t=e;let n=Number(document[t(543)](t(538))[t(389)].replace("₹",""))||0,a=Number(this.value[t(376)]("₹",""))||0;document.getElementById(t(419)).value="₹"+(n-a)}),s[e(322)](e(473),()=>{const t=e,n=document[t(540)]("tr");n[t(368)]=t(393),a.appendChild(n),n.querySelector(".customFeeAmount").addEventListener(t(498),l),n[t(462)](".customFeeName")[t(322)](t(498),l),n[t(462)](".removeRow")[t(322)]("click",()=>{n[t(513)](),l()})}),d[e(322)]("click",async()=>{const t=e;if(!c)return;const n=c.admNo;let a=null;const d={};if(document[t(332)](t(461))[t(508)](e=>{const n=t,o=e[n(462)](n(564));if(o&&"true"===o[n(389)]){const t=[];let o=e[n(483)];for(;o&&!o[n(462)](n(564));)t[n(377)]({name:o[n(378)][1][n(404)],amount:Number(o[n(378)][2][n(404)][n(376)]("₹",""))}),o=o[n(483)];const s=e[n(378)][0][n(404)];d[s]={fees:t,paid:!0},a=s}}),document[t(332)](t(461))[t(508)](e=>{const n=t,o=e.querySelector(n(407))?.[n(389)],s=Number(e[n(462)](".customFeeAmount")?.[n(389)]||0);if(o&&s>0){const e=a;d[e]||(d[e]={fees:[],paid:!0}),d[e][n(367)][n(377)]({name:o,amount:s})}}),0!==Object[t(552)](d)[t(356)])try{await update(ref(db,t(414)+n+t(314)),d);const e=Object[t(350)](d)[t(491)](e=>e[t(367)]).reduce((e,n)=>e+n[t(486)],0);let a=document[t(543)]("payTotalReceived")?.value||"₹"+e,s=Number(a.replace("₹",""))||0,r=Number(document.getElementById(t(351))?.[t(389)][t(376)]("₹",""))||0,l=Number(document[t(543)](t(472))?.value[t(376)]("₹",""))||0;let{newOutstanding:u,newAdvance:m}=function(e,n,a,o){const d=t;let s=a,c=o;if(n<e)s=e-n-o+a,o>0&&(c=Math[d(383)](0,o-(e-n)));else if(n>e){let t=n-e;if(a>0){let e=Math[d(457)](t,a);s=a-e,t-=e}t>0&&(c=o+t)}return{newOutstanding:s,newAdvance:c}}(e,s,r,l);document.getElementById(t(351))[t(389)]="₹"+u,document[t(543)](t(472))[t(389)]="₹"+m;const p=push(ref(db,t(364))),f=p.key;await set(p,{studentID:n,receiptID:f,date:(new Date).toISOString(),paidAmount:s,selectedTotal:e,outstanding:u,advance:m,paymentMode:document[t(543)](t(448))?.[t(389)]||t(456),note:document.getElementById("paymentNote")?.[t(389)]||"",monthsPaid:Object.fromEntries(Object.keys(d).map(e=>[e,!0]))}),await update(ref(db,t(414)+n),{outstanding:u,advance:m}),o.textContent="Payment recorded!",o[t(559)][t(296)]=t(506),o[t(559)][t(422)]="block",document.getElementById("payReceiptID")[t(389)]=f,o[t(306)]({behavior:"smooth",block:t(363)}),setTimeout(()=>o[t(559)][t(422)]=t(345),3e3),await i(n,c[t(366)]),await loadRecentPayments(n)}catch(e){o[t(404)]=t(478)+e.message,o[t(559)][t(422)]=t(440)}else alert(t(544))})}),window[a0_0x1898ea(322)]("DOMContentLoaded",()=>{loadCollections()}),window.generateAdminReport=generateAdminReport,window[a0_0x1898ea(337)]=exportReportToCSV,window[a0_0x1898ea(485)]=updatePaymentChart;